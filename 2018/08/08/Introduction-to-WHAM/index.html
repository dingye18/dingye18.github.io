<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Introduction to WHAM | Ye's Blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Introduction to WHAM</h1><a id="logo" href="/.">Ye's Blog</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Introduction to WHAM</h1><div class="post-meta">Aug 8, 2018<span> | </span><span class="category"><a href="/categories/reaserch-notes/">reaserch notes</a></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#introduction-to-wham"><span class="toc-number">1.</span> <span class="toc-text">Introduction to WHAM</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#umbrella-sampling"><span class="toc-number">1.1.</span> <span class="toc-text">Umbrella Sampling</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#partition-function-and-helmholtz-free-energy"><span class="toc-number">1.1.1.</span> <span class="toc-text">Partition function and Helmholtz free energy</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#umbrella-sampling-method"><span class="toc-number">1.1.2.</span> <span class="toc-text">UMBRELLA SAMPLING: METHOD</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#weighted-histogram-analysis-method"><span class="toc-number">1.2.</span> <span class="toc-text">Weighted Histogram Analysis Method</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#mathematical-analyze"><span class="toc-number">1.2.1.</span> <span class="toc-text">Mathematical Analyze</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#how-to-use-wham"><span class="toc-number">1.3.</span> <span class="toc-text">How to use WHAM</span></a></li></ol></li></ol></div></div><div class="post-content"><p>This is a blog for WHAM introduction. And it's also a notes for seminar of our lab 8.8. Most of this note will focus on mathematical background of WHAM. <a id="more"></a></p>
<h1 id="introduction-to-wham">Introduction to WHAM</h1>
<h2 id="umbrella-sampling">Umbrella Sampling</h2>
<h3 id="partition-function-and-helmholtz-free-energy">Partition function and Helmholtz free energy</h3>
<p>​ The canonical partition function <span class="math inline">\(Q\)</span> of a system can be calculated via an integral over the whole phase space.</p>
<p><span class="math display">\[
Q = \int exp(-\beta E(r))d^Nr
\]</span></p>
<p>where <span class="math inline">\(\beta = \frac{1}{k_BT}\)</span> . The free (Helmholtz) energy <span class="math inline">\(A\)</span> is related to <span class="math inline">\(Q\)</span> via <span class="math display">\[
A = -1/\beta \ln Q
\]</span> ​ In many cases, a reaction coordinate (<span class="math inline">\(\xi\)</span>), a continuous parameter which provide distinction between two thermodynamic states, can be defined. With <span class="math inline">\(\xi\)</span> defined, the probability distribution of the system along <span class="math inline">\(\xi\)</span> can be calculated by integrating out all degrees of freedom but <span class="math inline">\(\xi\)</span> : <span class="math display">\[
Q(\xi) = \frac{\int \delta[\xi(r)-\xi)]exp(-\beta E)d^Nr}{\int exp(-\beta E)d^Nr}
\]</span> <span class="math inline">\(Q(\xi)d\xi\)</span> can be interpreted as the probability of finding the system in a small interval <span class="math inline">\(d\xi\)</span> around <span class="math inline">\(\xi\)</span>. <span class="math display">\[
A(\xi) = -1/\beta\ln Q(\xi)
\]</span> <span class="math inline">\(A(\xi)\)</span> is also called potential of mean force (PMF).</p>
<p>​ In computer simulations, the direct phase-space integrals used in Eqs.(3) and (1) are impossible to calculate. However, if the system is ergodic, i.e. if every point in phase space is visited during the simulation, <span class="math inline">\(Q(\xi)\)</span> is equal to <span class="math display">\[
P(\xi) = \lim_{t\to\infty}\frac{1}{t}\int_{0}^{t}\rho[\xi(t&#39;)]dt&#39;
\]</span> ​ where <span class="math inline">\(t\)</span> denotes the time and <span class="math inline">\(\rho\)</span> simply counts the occurrence of <span class="math inline">\(\xi\)</span> in a given interval (of infinitesimal width in the exact equation and of finite width when calculating a histogram). So, in principle, <span class="math inline">\(A(\xi)\)</span> can be directly obtained from molecular dynamics (MD) simulations by monitoring <span class="math inline">\(P(\xi)\)</span> , the distribution of the system along the reaction coordinate.</p>
<h3 id="umbrella-sampling-method">UMBRELLA SAMPLING: METHOD</h3>
<p>​ A bias, an additional energy term, is applied to the system to ensure efficient sampling along the whole reaction coordinate. The effect of the bias potential to connect energetically separated regions in phase space gave rise to the name umbrella sampling.</p>
<p>​ The bias potential <span class="math inline">\(w_i\)</span> of windows <span class="math inline">\(i\)</span> is an additional energy term, which depends only on the reaction coordinate: <span class="math display">\[
E^b(r) = E^u(r)+w_i(\xi)
\]</span> ​ According to Eq.(3), the unbiased distribution is <span class="math display">\[
P_i^u(\xi_0) = \frac{\int \delta[\xi(r)-\xi_0)]exp(-\beta E(r))d^Nr}{\int exp(-\beta E(r))d^Nr}
\]</span> ​ MD simulation of the biased system provides the biased distribution along the reaction coordinate <span class="math inline">\(P_i^b\)</span>. <span class="math display">\[
P_i^b(\xi_0) = \frac{\int \delta[\xi(r)-\xi_0)]exp(-\beta [E(r)+w_i(\xi(r))])d^Nr}{\int exp(-\beta [E(r)+w_i(\xi(r))])d^Nr}
\]</span> ​ Because the bias energy <span class="math inline">\(w_i(\xi)\)</span> depends only on <span class="math inline">\(\xi\)</span> , and the integration in the enumerator is performed over all degrees of freedom but <span class="math inline">\(\xi\)</span> , <span class="math display">\[
P_i^b(\xi_0) = exp[-\beta w_i(\xi_0)]\frac{\int \delta[\xi(r)-\xi_0)]exp(-\beta E(r))d^Nr}{\int exp(-\beta [E(r)+w_i(\xi(r))])d^Nr}
\]</span> ​ Compared with Eq.(7), <span class="math display">\[
\begin{split}
P_i^u(\xi_0)&amp;= P_i^b(\xi_0)exp(\beta w_i(\xi_0))\cdot\frac{\int exp(-\beta E(r)) exp[-\beta w_i(\xi_0(r))] d^Nr}{\int exp(-\beta E(r))d^Nr}\\&amp;=P_i^b(\xi_0) exp(\beta w_i(\xi_0)) \langle exp[-\beta w_i(\xi_0)]\rangle 
\end{split}\tag{10}
\]</span> ​ From equation above, <span class="math inline">\(A_i(\xi)\)</span> can be readily evaluated, <span class="math display">\[
A_i(\xi_0) = -(1/\beta)\ln P_i^b(\xi_0)-w_i(\xi_0)+F_i \tag{11}
\]</span> where <span class="math inline">\(F_i = -(1/\beta)\ln(\langle exp[-\beta w_i(\xi_0)] \rangle)\)</span></p>
<p>​ If the free-energy curve <span class="math inline">\(A_i(\xi)\)</span> of more windows are to be combined to one global <span class="math inline">\(A(\xi)\)</span>, the <span class="math inline">\(F_i\)</span> have to be calculated. They are associated with introducing the bias potential and connect the free-energy curves <span class="math inline">\(A_i(\xi)\)</span> obtained in the different windows: <span class="math display">\[
\begin{split}
exp(-\beta F_i)&amp;=\langle exp(-\beta w_i(\xi)) \rangle \\&amp;=\int P^u(\xi)exp[-\beta w_i(\xi)]d\xi \\&amp;=
\int exp(-\beta [A(\xi)+w_i(\xi)]) d\xi
\end{split} \tag{12}
\]</span></p>
<h2 id="weighted-histogram-analysis-method">Weighted Histogram Analysis Method</h2>
<h3 id="mathematical-analyze">Mathematical Analyze</h3>
<p>​ Numerous methods have been proposed for an estimation of <span class="math inline">\(F_i\)</span>, a promising one being the <strong><em>WHAM</em></strong>. It aims to minimize the statistical error of <span class="math inline">\(P^u(\xi)\)</span> . The global distribution is calculated by weighted average of the distributions of the individual windows: <span class="math display">\[
P^u(\xi) = \sum_{i}^{windows}p_iP_i^u(\xi) \tag{13}
\]</span> ​ The weights <span class="math inline">\(p_i\)</span> are chosen in order to minimize the statistical error of <span class="math inline">\(P^u\)</span>: <span class="math display">\[
\frac{\partial \sigma^2(P^u) }{\partial p_i}=0
\]</span> under the condition <span class="math inline">\(\sum p_i=1\)</span>. This minimization problem can be solved with Lagrange multiplier method. <span class="math display">\[
\mathcal{L}(p_i,\mu) = \sum_{i=1}^{N} p_i^2 \sigma^2[P_i^u(\xi)] - \mu(\sum_{i=1}^{N}p_i-1)
\]</span> And this leads to <span class="math display">\[
p_i = \frac{(\sigma^2[P_i^u(\xi)])^{-1}}{\sum_{j=1}^{N}\sigma^2[P_j^u(\xi)])^{-1}}=
\frac{n_i exp(-\beta[w_i(\xi)-F_i])}{\sum_{j=1}^{N}n_j exp(-\beta[w_j(\xi)-F_j])}
\]</span> ​ According to Umbrella Sampling, <span class="math display">\[
P_i^u(\xi) = exp(\beta[w_i(\xi)-F_i])P_i^b(\xi)
\]</span> ​ The <span class="math inline">\(P^u(\xi)\)</span> takes this form, <span class="math display">\[
P^u(\xi) = \sum_{i=1}^{N}\frac{n_i}{\sum_{j=1}^{N} n_j e^{-\beta[w_j(\xi)-F_j]}}P_i^b(\xi).
\]</span> where <span class="math inline">\(n_i\)</span> being the total number of steps sampled for window <span class="math inline">\(i\)</span>. <span class="math inline">\(N\)</span> is the number of windows. <span class="math inline">\(P_i^b(\xi)\)</span> is the actual distribution of configurations occurring during the <span class="math inline">\(i\)</span>th of these simulations. It may be formally expressed as, <span class="math display">\[
P_i^b(\xi)=\frac{1}{n_i}\sum_{l=1}^{n_i}\delta(\xi-\xi_{i,l})
\]</span> ​ The free energies corresponding to the different biasing potentials can be computed using the distribution <span class="math inline">\(P^u(\xi)\)</span> , thus, <span class="math display">\[
\begin{split}
e^{-\beta F_k}&amp;=\int d\xi P^u(\xi)e^{-\beta w_k(\xi)}\\
&amp;=\sum_{i=1}^{N}\sum_{l=1}^{n_i}\frac{e^{-\beta w_k(\xi_{i,l})}}{\sum_{j=1}^{N} n_je^{-\beta[w_j(\xi_{i,l})-F_j]}}
\end{split}
\]</span> ​ The <span class="math inline">\(\{ F_i\}\)</span> can be computed iteratively.</p>
<h2 id="how-to-use-wham">How to use WHAM</h2>
<p>You can refer to <a href="http://membrane.urmc.rochester.edu/content/wham" target="_blank" rel="noopener">WHAM</a>. It's a very popular version of WHAM implementation.</p>
</div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>Ye Ding</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="/2018/08/08/Introduction-to-WHAM/">https://dingye18.github.io/2018/08/08/Introduction-to-WHAM/</a></li><li class="post-copyright-license"><strong>版权声明：</strong>All rights reserved.</li></ul></div><br><div class="tags"></div><div class="post-nav"><a class="pre" href="/2018/08/11/Introduction-to-Julia/">Introduction to Julia</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="https://dingye18.github.io"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/reaserch-notes/">reaserch notes</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/08/11/Introduction-to-Julia/">Introduction to Julia</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/08/Introduction-to-WHAM/">Introduction to WHAM</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://github.com/dingye18" title="Github" target="_blank">Github</a><ul></ul><a href="https://www.facebook.com/profile.php?id=100009283781661" title="Facebook" target="_blank">Facebook</a><ul></ul><a href="https://twitter.com/YeDing6" title="Twitter" target="_blank">Twitter</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">Ye's Blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
  });
</script><script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML" async></script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>