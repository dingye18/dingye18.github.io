<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Introduction to WHAM | Ye's Blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Introduction to WHAM</h1><a id="logo" href="/.">Ye's Blog</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Introduction to WHAM</h1><div class="post-meta">Aug 8, 2018<span> | </span><span class="category"><a href="/categories/reaserch-notes/">reaserch notes</a></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Introduction-to-WHAM"><span class="toc-number">1.</span> <span class="toc-text">Introduction to WHAM</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Umbrella-Sampling"><span class="toc-number">1.1.</span> <span class="toc-text">Umbrella Sampling</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Partition-function-and-Helmholtz-free-energy"><span class="toc-number">1.1.1.</span> <span class="toc-text">Partition function and Helmholtz free energy</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UMBRELLA-SAMPLING-METHOD"><span class="toc-number">1.1.2.</span> <span class="toc-text">UMBRELLA SAMPLING: METHOD</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Weighted-Histogram-Analysis-Method"><span class="toc-number">1.2.</span> <span class="toc-text">Weighted Histogram Analysis Method</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Mathematical-Analyze"><span class="toc-number">1.2.1.</span> <span class="toc-text">Mathematical Analyze</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#How-to-use-WHAM"><span class="toc-number">1.3.</span> <span class="toc-text">How to use WHAM</span></a></li></ol></li></ol></div></div><div class="post-content"><p>This is a summary notes of my work for the last month. And it&#x2019;s also a notes for seminar of our lab 8.9. The mainly work of this notes is going to introduce  to visiters. It focus on mathematical background of WHAM.<br><a id="more"></a></p>
<h1 id="Introduction-to-WHAM"><a href="#Introduction-to-WHAM" class="headerlink" title="Introduction to WHAM"></a>Introduction to WHAM</h1><h2 id="Umbrella-Sampling"><a href="#Umbrella-Sampling" class="headerlink" title="Umbrella Sampling"></a>Umbrella Sampling</h2><h3 id="Partition-function-and-Helmholtz-free-energy"><a href="#Partition-function-and-Helmholtz-free-energy" class="headerlink" title="Partition function and Helmholtz free energy"></a>Partition function and Helmholtz free energy</h3><p>&#x200B;    The canonical partition function $Q$ of a system can be calculated via an integral over the whole phase space.</p>
<p>$$<br>Q = \int exp(-\beta E(r))d^Nr<br>$$</p>
<p>where $\beta = \frac{1}{k_BT}$ . The free (Helmholtz) energy $A$ is related to $Q$ via<br>$$<br>A = -1/\beta \ln Q<br>$$<br>&#x200B;    In many cases, a reaction coordinate ($\xi$), a continuous parameter which provide distinction between two thermodynamic states, can be defined. With $\xi$ defined, the probability distribution of the system along $\xi$ can be calculated by integrating out all degrees of freedom but $\xi$  :<br>$$<br>Q(\xi) = \frac{\int \delta[\xi(r)-\xi)]exp(-\beta E)d^Nr}{\int exp(-\beta E)d^Nr}<br>$$<br>$Q(\xi)d\xi$ can be interpreted as the probability of finding the system in a small interval $d\xi$ around $\xi$.<br>$$<br>A(\xi) = -1/\beta\ln Q(\xi)<br>$$<br>$A(\xi)$ is also called potential of mean force (PMF).</p>
<p>&#x200B;    In computer simulations, the direct phase-space integrals used in Eqs.(3) and (1) are impossible to calculate. However, if the system is ergodic, i.e. if every point in phase space is visited during the simulation, $Q(\xi)$ is equal to<br>$$<br>P(\xi) = \lim_{t\to\infty}\frac{1}{t}\int_{0}^{t}\rho[\xi(t&#x2019;)]dt&#x2019;<br>$$<br>&#x200B;    where $t$ denotes the time and $\rho$ simply counts the occurrence of $\xi$ in a given interval (of infinitesimal width in the exact equation and of finite width when calculating a histogram). So, in principle, $A(\xi)$ can be directly obtained from molecular dynamics (MD) simulations by monitoring $P(\xi)$ , the distribution of the system along the reaction coordinate.</p>
<h3 id="UMBRELLA-SAMPLING-METHOD"><a href="#UMBRELLA-SAMPLING-METHOD" class="headerlink" title="UMBRELLA SAMPLING: METHOD"></a>UMBRELLA SAMPLING: METHOD</h3><p>&#x200B;    A bias, an additional energy term, is applied to the system to ensure efficient sampling along the whole reaction coordinate. The effect of the bias potential to connect energetically separated regions in phase space gave rise to the name umbrella sampling.</p>
<p>&#x200B;    The bias potential $w_i$ of windows $i$ is an additional energy term, which depends only on the reaction coordinate:<br>$$<br>E^b(r) = E^u(r)+w_i(\xi)<br>$$<br>&#x200B;    According to Eq.(3), the unbiased distribution is<br>$$<br>P_i^u(\xi_0) = \frac{\int \delta[\xi(r)-\xi_0)]exp(-\beta E(r))d^Nr}{\int exp(-\beta E(r))d^Nr}<br>$$<br>&#x200B;    MD simulation of the biased system provides the biased distribution along the reaction coordinate $P_i^b$.<br>$$<br>P_i^b(\xi_0) = \frac{\int \delta[\xi(r)-\xi_0)]exp(-\beta [E(r)+w_i(\xi(r))])d^Nr}{\int exp(-\beta [E(r)+w_i(\xi(r))])d^Nr}<br>$$<br>&#x200B;    Because the bias energy $w_i(\xi)$ depends only on $\xi$ , and the integration in the enumerator is performed over all degrees of freedom but $\xi$ ,<br>$$<br>P_i^b(\xi_0) = exp[-\beta w_i(\xi_0)]\frac{\int \delta[\xi(r)-\xi_0)]exp(-\beta E(r))d^Nr}{\int exp(-\beta [E(r)+w_i(\xi(r))])d^Nr}<br>$$<br>&#x200B;    Compared with Eq.(7),<br>$$<br>\begin{split}<br>P_i^u(\xi_0)&amp;= P_i^b(\xi_0)exp(\beta w_i(\xi_0))\cdot\frac{\int exp(-\beta E(r)) exp[-\beta w_i(\xi_0(r))] d^Nr}{\int exp(-\beta E(r))d^Nr}\&amp;=P_i^b(\xi_0) exp(\beta w_i(\xi_0)) \langle exp[-\beta w_i(\xi_0)]\rangle<br>\end{split}\tag{10}<br>$$<br>&#x200B;    From equation above, $A_i(\xi)$ can be readily evaluated,<br>$$<br>A_i(\xi_0) = -(1/\beta)\ln P_i^b(\xi_0)-w_i(\xi_0)+F_i \tag{11}<br>$$<br>where $F_i = -(1/\beta)\ln(\langle  exp[-\beta w_i(\xi_0)] \rangle)$ </p>
<p>&#x200B;    If the free-energy curve $A_i(\xi)$ of more windows are to be combined to one global $A(\xi)$, the $F_i$ have to be calculated. They are associated with introducing the bias potential and connect the free-energy curves $A_i(\xi)$ obtained in the different windows:<br>$$<br>\begin{split}<br>exp(-\beta F_i)&amp;=\langle exp(-\beta w_i(\xi)) \rangle \&amp;=\int P^u(\xi)exp[-\beta w_i(\xi)]d\xi \&amp;=<br>\int exp(-\beta [A(\xi)+w_i(\xi)]) d\xi<br>\end{split} \tag{12}<br>$$</p>
<h2 id="Weighted-Histogram-Analysis-Method"><a href="#Weighted-Histogram-Analysis-Method" class="headerlink" title="Weighted Histogram Analysis Method"></a>Weighted Histogram Analysis Method</h2><h3 id="Mathematical-Analyze"><a href="#Mathematical-Analyze" class="headerlink" title="Mathematical Analyze"></a>Mathematical Analyze</h3><p>&#x200B;    Numerous methods have been proposed for an estimation of $F_i$,  a promising one being the <strong><em>WHAM</em></strong>. It aims to minimize the statistical error of $P^u(\xi)$ . The global distribution is calculated by weighted average of the distributions of the individual windows:<br>$$<br>P^u(\xi) = \sum_{i}^{windows}p_iP_i^u(\xi) \tag{13}<br>$$<br>&#x200B;    The weights $p_i$ are chosen in order to minimize the statistical error of $P^u$:<br>$$<br>\frac{\partial \sigma^2(P^u) }{\partial p_i}=0<br>$$<br>under the condition $\sum p_i=1$. This minimization problem can be solved with Lagrange multiplier method.<br>$$<br>\mathcal{L}(p_i,\mu) = \sum_{i=1}^{N} p_i^2 \sigma^2[P_i^u(\xi)] - \mu(\sum_{i=1}^{N}p_i-1)<br>$$<br>And this leads to<br>$$<br>p_i = \frac{(\sigma^2[P_i^u(\xi)])^{-1}}{\sum_{j=1}^{N}\sigma^2[P_j^u(\xi)])^{-1}}=<br>\frac{n_i exp(-\beta[w_i(\xi)-F_i])}{\sum_{j=1}^{N}n_j exp(-\beta[w_j(\xi)-F_j])}<br>$$<br>&#x200B;    According to Umbrella Sampling,<br>$$<br>P_i^u(\xi) = exp(\beta[w_i(\xi)-F_i])P_i^b(\xi)<br>$$<br>&#x200B;    The $P^u(\xi)$ takes this form,<br>$$<br>P^u(\xi) = \sum_{i=1}^{N}\frac{n_i}{\sum_{j=1}^{N} n_j e^{-\beta[w_j(\xi)-F_j]}}P_i^b(\xi).<br>$$<br> where $n_i$ being the total number of steps sampled for window $i$. $N$ is the number of windows. $P_i^b(\xi)$ is the actual distribution of configurations occurring during the $i$th of these simulations. It may be formally expressed as,<br>$$<br>P_i^b(\xi)=\frac{1}{n_i}\sum_{l=1}^{n_i}\delta(\xi-\xi_{i,l})<br>$$<br>&#x200B;    The free energies corresponding to the different biasing potentials can be computed using the distribution $P^u(\xi)$ , thus,<br>$$<br>\begin{split}<br>e^{-\beta F_k}&amp;=\int d\xi P^u(\xi)e^{-\beta w_k(\xi)}\<br>&amp;=\sum_{i=1}^{N}\sum_{l=1}^{n_i}\frac{e^{-\beta w_k(\xi_{i,l})}}{\sum_{j=1}^{N} n_je^{-\beta[w_j(\xi_{i,l})-F_j]}}<br>\end{split}<br>$$<br>&#x200B;    The ${ F_i}$ can be computed iteratively.      </p>
<h2 id="How-to-use-WHAM"><a href="#How-to-use-WHAM" class="headerlink" title="How to use WHAM"></a>How to use WHAM</h2><p>You can refer to <a href="http://membrane.urmc.rochester.edu/content/wham" target="_blank" rel="noopener">WHAM</a>. It&#x2019;s a very popular version of WHAM implementation.</p>
</div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>Ye Ding</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="/2018/08/08/Introduction-to-WHAM/">https://dingye18.github.io/2018/08/08/Introduction-to-WHAM/</a></li><li class="post-copyright-license"><strong>版权声明：</strong>All rights reserved.</li></ul></div><br><div class="tags"></div><div class="post-nav"><a class="pre" href="/2018/08/09/hello-world/">Hello World</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="https://dingye18.github.io"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/reaserch-notes/">reaserch notes</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/08/09/hello-world/">Hello World</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/08/Introduction-to-WHAM/">Introduction to WHAM</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://github.com/dingye18" title="Github" target="_blank">Github</a><ul></ul><a href="https://www.facebook.com/profile.php?id=100009283781661" title="Facebook" target="_blank">Facebook</a><ul></ul><a href="https://twitter.com/YeDing6" title="Twitter" target="_blank">Twitter</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">Ye's Blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
  });
</script><script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML" async></script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>